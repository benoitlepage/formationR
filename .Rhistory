y = list(1:5, letters[1:10], 1:20))
#  - il ne change pas les noms de colonnes que l'on souhaite écrire dans un format non-conventionnelle
data.frame(`1 N (%)` = 1:3) # la commande data frame a changé le nom de variable
tibble(`1 N (%)` = 1:3) # le nom de variable non-conventionnel est conservé
#  - il recycle uniquement les vecteurs de longueur 1 pour éviter des erreurs
data.frame(id = 1:10,
var1 = 20:24, # ces valeurs sont recyclées avec data.frame
var2 = 30) # la valeur est recyclée avec data.frame
tibble(id = 1:10,
var1 = 20:24, # message d'erreur en cas valeurs de longueur > 1
var2 = 30)
library(tidyverse)
# 1) Importer les données ----
df_1 <- read_csv2("data/df_1.csv")
meta_df_1 <- read_csv2("data/meta_df_1.csv")
class(df_1)  # [1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame"
# Voir les différences par rapport au data.frames https://tibble.tidyverse.org/articles/tibble.html
# La base de données est importé au format "tibble" (abbréviation "tbl"), grâce au package [`tibble`](https://tibble.tidyverse.org/)
# à la différence des data.frames:
#  - tibble ne prend pas en compte les rownames()
df_test <- data.frame(a = 10:15, b = letters[1:6])
rownames(df_test) <- c("janvier", "février", "mars", "avril", "mai", "juin")
rownames(df_test)
rownames(as_tibble(df_test)) # [1] "1" "2" "3" "4" "5" "6"
#  - il est facile de créer des colonnes correspondant à des listes (un vecteur comportant des valeurs de types différents)
tibble(x = 1:3,
y = list(1:5, letters[1:10], 1:20))
data.frame(`1 N (%)` = 1:3) # la commande data frame a changé le nom de variable
tibble(`1 N (%)` = 1:3) # le nom de variable non-conventionnel est conservé
data.frame(id = 1:10,
var1 = 20:24, # ces valeurs sont recyclées avec data.frame
var2 = 30) # la valeur est recyclée avec data.frame
tibble(id = 1:10,
var1 = 20:24, # message d'erreur en cas valeurs de longueur > 1
var2 = 30)
tibble(id = 1:10,
var2 = 30)
df_1[c(100:103), c(2,3)]
# on peut sélectionner une variable avec [[]] ou l'opérateur dollar (comme pour les data.frames)
df_1[[4]]
df_1$trait
df_1
glimpse(df_1)
arrange(df_1, sex, imc) # trie la base df_1 sur le sexe, puis sur l'imc
slice_head(df_1, n = 5) # voir les 5 premières lignes
df_1 %>% arrange(sex, imc) %>% slice_head(n = 6)  # voir les 6 premières lignes
df_1 %>% slice_head(n = 6) %>% arrange(sex, imc) # ici, on a d'abord séléctionné
df_1 %>% slice_tail(prop = 0.01) # voir 1% des dernières lignes (càd 3 lignes)
df_1 %>% slice(4, 10, 15)
df_1 %>% filter(sex == 0 & imc < 21)
# si on écrit plusieurs conditions séparées par une virgule,
# c'est équivalent à des conditions séparées par ET (condition1 & condition2)
df_1 %>% filter(sex == 0, imc < 21)
# c'est équivalent à la sélection par condition entre crochets de R base
df_1[df_1$sex == 0 & df_1$imc < 21, ]
f_1 %>% select(c(sex, trait)) # sélectionne les colonnes sexe et trait
df_1 %>% select(c(sex, trait)) # sélectionne les colonnes sexe et trait
df_1 %>% select(sex, trait) # équivalent à la syntaxe précédente (pas besoin de c())
# c'est équivalent à la sélection par indexation sur le nom R base
df_1[,c("sex", "trait")]
df_1 %>% select(subjid:imc) # sélectionne les colonnes allant de sexe à imc
df_1 %>% select(!sex) # ensemble complémentaire de la variable sexe
df_1 %>% select(-sex, -imc) # toutes les variables sauf sex et imc
df_1 %>% select(last_col()) # sélectionne la dernière colonne
df_1 %>% select(starts_with("pa")) # toutes les variables dont le nom commence par "pa"
df_1 %>% select(ends_with("as")) # toutes les variables dont le nom termine par "as"
df_1 %>% select(contains("bj")) # toutes les variables dont le nom contient par "bj"
# on peut également combiner plusieurs modes de sélection :
df_1 %>% select(subjid, starts_with("im"), last_col())
df_1 %>% select(Sexe = sex, Traitement = trait)
# on peut s'en servir pour changer l'ordre des variables
select(df_1,
imc, trait, subjid, # commence avec ces 3 variables dans cet ordre
everything()) # everything() sélection toutes les autres variables
### pour sélectionner une variable et la retourner comme une colonne de base de données :
df_1[3]
class(df_1[3]) # c'est une base de données (tibble ou data.frame)
# équivalent en dplyr
select(df_1, imc)
class(select(df_1, imc)) # c'est une base de données (tibble ou data.frame)
### pour sélectionner une variable et la retourner comme un vecteur :
df_1$imc # retourne le vecteur imc (équivalent à df_1[["imc"]])
df_1[[3]]
df_1[["imc"]]
class(df_1$imc) # c'est un vecteur numérique
typeof(df_1$imc) # un vecteur de réels (double) pour être plus précis
# équivalent en dplyr
pull(df_1, imc)
class(pull(df_1, imc)) # c'est un vecteur numérique
typeof(pull(df_1, imc)) # un vecteur de réels (double) pour être plus précis
library(forcats)
df_1 %>% mutate(obesite = if_else(df_1$imc >= 30, 1, 0))
df_1 <- df_1 %>%
mutate(obesite = if_else(df_1$imc >= 30, 1, 0))
df_1
ifelse(1:10 < 5, "<5", 0)
if_else(1:10 < 5, "<5", 0) #
ifelse(Date(c("2025-09-01","2024-09-01") < "2025-01-01", 1, 0))
if_else(Date(c("2025-09-01","2024-09-01") < "2025-01-01", 1, 0))
Date(c("2025-09-01","2024-09-01")
ifelse(Date(c("2025-09-01","2024-09-01")) < "2025-01-01", 1, 0)
Date(c("2025-09-01","2024-09-01"))
as.Date(c("2025-09-01","2024-09-01"))
ifelse(as.Date(c("2025-09-01","2024-09-01")) < "2025-01-01", 1, 0)
if_else(as.Date(c("2025-09-01","2024-09-01")) < "2025-01-01", 1, 0)
as.integer(as.Date("2025-01-01"))
ifelse(as.Date(c("2025-09-01","2024-09-01")) < 20089, 1, 0)
if_else(as.Date(c("2025-09-01","2024-09-01")) < 20089, 1, 0)
ifelse(c(1,2,NA,4,5) <= 3, 1, 0)
if_else(c(1,2,NA,4,5) <= 3, 1, 0, missing = NULL) # renvoie NA pour la valeur manquante
if_else(c(1,2,NA,4,5) <= 3, 1, 0, missing = 9) # renvoie NA pour la valeur manquante
df_1 %>%
mutate(obesite = if_else(df_1$imc >= 30, 1, 0)) %>%
glimpse()
df_1 %>%
mutate(obesite = if_else(df_1$imc >= 30, 1, 0)) %>%
by_group(obesite) %>%
summarise(min = min(imc),
max = max(imc))
df_1 %>%
mutate(obesite = if_else(df_1$imc >= 30, 1, 0)) %>%
group_by(obesite) %>%
summarise(min = min(imc),
max = max(imc))
df_1 %>%
group_by(obesity)
df_1
df_1 %>%
group_by(obesite)
df_1
?summarise()
df_1 <- df_1 %>%
mutate(imc_cl = case_when(imc < 18.5 ~ 1,
imc >= 18.5 & imc < 25 ~ 2,
imc >= 25 & imc < 30 ~ 3,
imc >= 30 ~ 4))
### vérifier que la variable a été correctement créée
df_1 %>%
group_by(imc_cl) %>%
summarise(min = min(imc),
max = max(imc))
df_1 %>% rename(imc_en_classe = imc_cl)
df_1
df_1 %>% table(imc_cl ~ obesite)
df_1 %>% count(imc_cl, obesite)
df_1 %>% group_by(imc_cl, obesite) %>% summarise(n = n())
?base::table
df_1 %>% table(as.factor(imc_cl), as.factor(obesite))
df_1 %>% table(as.factor(df_1$imc_cl), as.factor(df_1$obesite))
table(df_1$imc_cl, df_1$obesite)
with(df_1, table(imc_cl, obesite, deparse.level = 2)
with(df_1, table(imc_cl, obesite, deparse.level = 2))
table(df_1$imc_cl, df_1$obesite, deparse.level = 2)
with(df_1, table(as.factor(imc_cl), as.factor(obesite), deparse.level = 2))
with(df_1, table(as.factor(imc_cl), as.factor(obesite)))
with(df_1, table(as.factor(imc_cl), as.factor(obesite), deparse.level = 1))
with(df_1, table(as.factor(imc_cl), as.factor(obesite), deparse.level = 2))
df_1 %>% group_by(imc_cl, obesite) %>% summarise(n = n())
df_1 %>% count(imc_cl, obesite) # équivalent à la commande précédente
slice(df_1)
df_1
slice_head(df_1)
relocate(df_1, obesite, imc_cl, .after = trait)
df_1 %>% relocate(obesite, imc_cl, .after = trait) %>% slice_head()
df_1 %>% relocate(obesite, imc_cl, .after = imc) %>% slice_head()
df_1 %>% relocate(imc_cl, obesite, .after = imc) %>% slice_head()
slice_head(df_1)
df_1 %>% relocate(imc_cl, obesite, .after = imc) %>% slice_head()
meta_df_1
df_1
meta_df_1 %>% add_row(var = rep("imc_cl", 4),
label = rep("IMC en classes", 4),
id_labs = 1:4,
code_labs = 1:4,
labs = c("Maigreur", "Normal", "Surpoids", "Obèse"))
meta_df_1 %>% add_row(var = rep("obesite", 2),
label = rep("Obésité", 2),
id_labs = c(1,2),
code_labs = c(0,1),
labs = c("Non", "Oui"),
.before = 9)
meta_df_1
meta_df_1 <- meta_df_1 %>% add_row(var = rep("imc_cl", 4),
label = rep("IMC en classes", 4),
id_labs = 1:4,
code_labs = 1:4,
labs = c("Maigreur", "Normal", "Surpoids", "Obèse"))
meta_df_1
meta_df_1 %>% add_row(var = rep("obesite", 2),
label = rep("Obésité", 2),
id_labs = c(1,2),
code_labs = c(0,1),
labs = c("Non", "Oui"),
.before = 9)
meta_df_1 <- meta_df_1 %>% add_row(var = rep("obesite", 2),
label = rep("Obésité", 2),
id_labs = c(1,2),
code_labs = c(0,1),
labs = c("Non", "Oui"),
.before = 9)
meta_df_1
df_1 %>% filter(subjid == 137)
df_1 %>% mutate(pas = ifelse(subjid == 1, 123, NA)) %>% filter(subjid == 137)
df_1 %>% filter(subjid == 135:140)
df_1 %>% filter(subjid %in% 135:140)
df_1 %>% mutate(pas = ifelse(subjid == 137, 123, NA)) %>% filter(subjid %in% 135:140)
df_1 %>% mutate(pas = ifelse(subjid == 137, 123, pas)) %>% filter(subjid %in% 135:140)
library(tidyverse)
# 1) Importer les données ----
df_1 <- read_csv2("data/df_1.csv")
meta_df_1 <- read_csv2("data/meta_df_1.csv")
class(df_1)
df_1 %>%
mutate(obesite = if_else(df_1$imc >= 30, 1, 0))
df_1 # la variable n'a pas été enregistrée dans la base df_1 !
df_1 <- df_1 %>%
mutate(obesite = if_else(df_1$imc >= 30, 1, 0))
df_1 # ici, on voit que la variable a bien été ajoutée dans la base df_1
# Vérifier que la variable est crée correctement en calculant le min et le max
# dans chaque groupe d'obésité nouvellement créé :
# on va utiliser la fonction summarise qui permet de calculer différents paramètres
# d'une distribution de variables, voir ?summarise()
# ces analyses peuvent se faire par sous-groupes, qui ont identifiés en amont
# par la fonction group_by()
df_1 %>%
group_by(obesite) %>% # prépare à une analyse par groupe
summarise(min = min(imc), # calcul le min et max selon les groupes définis
max = max(imc)) # par la fonction "group_by()"
# note : summarise()/summarize() peut s'écrire avec un "s" ou un "z"
### Créer la variable imc à 4 classe, on peut utiliser pour cela la fonction case_when
### qui fonctionne selon le principe de if_else, mais pour plus de 2 catégories :
### voir ?case_when : chaque catégorie va être définie par une formule avec :
### la condition à gauche du signe ~ et la valeur à assigner à droite du signe ~
df_1 <- df_1 %>%
mutate(imc_cl = case_when(imc < 18.5 ~ 1,
imc >= 18.5 & imc < 25 ~ 2,
imc >= 25 & imc < 30 ~ 3,
imc >= 30 ~ 4))
meta_df_1
# on commence par rajouter les labels de la variable imc_cl
meta_df_1 <- meta_df_1 %>% add_row(var = rep("imc_cl", 4),
label = rep("IMC en classes", 4),
id_labs = 1:4,
code_labs = 1:4,
labs = c("Maigreur", "Normal", "Surpoids", "Obèse"))
meta_df_1
# on ajoute les lables de la variable obesite
# mais en les positionnant juste avant les labels de imc_cl
meta_df_1 <- meta_df_1 %>% add_row(var = rep("obesite", 2),
label = rep("Obésité", 2),
id_labs = c(1,2),
code_labs = c(0,1),
labs = c("Non", "Oui"),
.before = 9) # avant la 9ème ligne
df_1 %>% filter(subjid %in% 135:140)
tibble(a = 1:3, b = letters[c(1:2, NA)], c = 0.5 + 0:2)
rows_update(data, tibble(a = 2:3, b = "z"))
data <- tibble(a = 1:3, b = letters[c(1:2, NA)], c = 0.5 + 0:2)
rows_update(data, tibble(a = 2:3, b = "z"))
df_1 %>% filter(subjid %in% 135:140)
df_1 %>% rows_update(subjid = 137, pas = 123)
df_1 %>% rows_update(tibble(subjid = 137, pas = 123)) %>% filter(subjid %in% 135:140)
df_1 %>% rows_update(tibble(subjid = 137, pas = 123))
df_1 %>% # ici, on fait une transformation temporaire, car pas d'assignation
rows_update(tibble(subjid = 137, pas = 133)) %>% # revient à la valeur de 133
filter(subjid %in% 135:140)
df_1 %>% filter(subjid %in% 135:140)
df_1 <- df_1 %>% mutate(pas = ifelse(subjid == 137, 123, pas))
df_1 %>% filter(subjid %in% 135:140)
df_1 %>% # ici, on fait une transformation temporaire, car pas d'assignation
rows_update(tibble(subjid = 137, pas = 133)) %>% # revient à la valeur de 133
filter(subjid %in% 135:140)
df_1 %>% filter(subjid %in% 135:140)
write_csv2(df_1, "data/df_1_new.csv")
?summarize()
df_1
df_1 %>% summarise(n = n(!is.na(imc)),
mean = mean(imc),
sd = sd(imc),
min = min(imc),
max = max(imc),
med = median(imc),
iqr = IQR(imc))
df_1 %>% summarise(n = n(imc),
mean = mean(imc),
sd = sd(imc),
min = min(imc),
max = max(imc),
med = median(imc),
iqr = IQR(imc))
df_1 %>% summarise(mean = mean(imc),
sd = sd(imc),
min = min(imc),
max = max(imc),
med = median(imc),
iqr = IQR(imc))
df_1 %>% summarise(mean = mean(imc),
sd = sd(imc),
min = min(imc),
quantiles = quantile(imc, pros = seq(0, 1, 0.25)))
df_1 %>% summarise(mean = mean(imc),
sd = sd(imc),
min = min(imc),
quantiles = quantile(imc, probs = seq(0, 1, 0.25)))
df_1 %>% summarise(mean = mean(imc),
sd = sd(imc),
min = min(imc),
quantiles = quantile(imc, probs = 0.25))
df_1 %>% summarise(mean = mean(imc),
sd = sd(imc),
min = min(imc),
p25 = quantile(imc, probs = 0.25),
med = median(imc),
p75 = quantile(imc, probs = 0.75),
max = max(imc))
df_1 %>% summarise(mean = mean(imc, pas))
df_1 %>% summarise(.vars = c(imc, pas),
mean = mean())
df_1 %>% summarise(vars(imc, pas),
mean, sd,
min,
p25 = quantile(probs = 0.25),
med = median,
p75 = quantile(probs = 0.75),
max)
df_1 %>% summarise(vars(imc, pas),
mean)
df_1 %>% summarise(vars(imc, pas),
mean, na.rm = TRUE)
df_1 %>% summarise(c("imc", "pas"),
mean, na.rm = TRUE)
starwars %>%
summarise_at(c("height", "mass"), mean, na.rm = TRUE)
df_1 %>% summarise_at(c("imc", "pas"),
mean, na.rm = TRUE)
df_1 %>% summarise(n = n(imc),
mean = mean(imc),
sd = sd(imc),
min = min(imc),
p25 = quantile(imc, probs = 0.25),
med = median(imc),
p75 = quantile(imc, probs = 0.75),
max = max(imc))
df_1 %>% summarise(n = n(),
mean = mean(imc),
sd = sd(imc),
min = min(imc),
p25 = quantile(imc, probs = 0.25),
med = median(imc),
p75 = quantile(imc, probs = 0.75),
max = max(imc))
df_1 %>% summarise(n = n(!is.na(imc)),
mean = mean(imc),
sd = sd(imc),
min = min(imc),
p25 = quantile(imc, probs = 0.25),
med = median(imc),
p75 = quantile(imc, probs = 0.75),
max = max(imc))
df_1 %>% summarise(n = n(),
mean = mean(imc),
sd = sd(imc),
min = min(imc),
p25 = quantile(imc, probs = 0.25),
med = median(imc),
p75 = quantile(imc, probs = 0.75),
max = max(imc))
df_1 %>% summarise(n = sum(!is.na(imc)),
mean = mean(imc),
sd = sd(imc),
min = min(imc),
p25 = quantile(imc, probs = 0.25),
med = median(imc),
p75 = quantile(imc, probs = 0.75),
max = max(imc))
df_1 %>% summarise(n = sum(!is.na(imc)), # nombre de non-manquants
mean = mean(imc),
sd = sd(imc),
min = min(imc),
p25 = quantile(imc, probs = 0.25),
med = median(imc),
p75 = quantile(imc, probs = 0.75),
max = max(imc),
na.rm = TRUE)
df_1 %>% summarise(n = sum(!is.na(imc)), # nombre de non-manquants
mean = mean(imc),
sd = sd(imc),
min = min(imc),
p25 = quantile(imc, probs = 0.25),
med = median(imc),
p75 = quantile(imc, probs = 0.75),
max = max(imc))
df_1 %>% summarise_at(c("imc", "pas"),
mean, na.rm = TRUE)
df_1 %>% summarise_at(c("imc", "pas"),
mean, sd, na.rm = TRUE)
df_1 %>% summarise_at(c("imc", "pas"),
list(mean, sd),
na.rm = TRUE)
df_1 %>% summarise_at(c("imc", "pas"),
list(mean = mean,
sd = sd),
na.rm = TRUE)
by_species %>%
summarise_all(list(min, max))
df_1 %>% summarise(across(everything(), list(min = min, max = max)))
df_1 %>% summarise_at(c("imc", "pas"),
list(mean = mean,
sd = sd),
na.rm = TRUE)
df_1 %>% vars(imc, pas)
df_1 %>% vars(imc)
starwars %>% summarise(across(c("height", "mass"), ~ mean(.x, na.rm = TRUE)))
starwars %>%
summarise_at(vars(height:mass), mean, na.rm = TRUE)
starwars %>%
summarise(across(height:mass, ~ mean(.x, na.rm = TRUE)))
df_1 %>% summarise_at(.vars = vars(imc, pas),
.funs = c(n = sum(!is.na()),
mean = mean(),
sd = sd()))
df_1 %>% summarise_at(.vars = vars(imc, pas),
.funs = c(mean = mean(),
sd = sd()))
df_1 %>% summarise_at(.vars = vars(imc, pas),
.funs = c(mean = mean(x),
sd = sd(x)))
df_1 %>% summarise_at(.vars = vars(imc, pas),
.funs = c(mean = "mean",
sd = "sd"))
df_1
for(i in c(3,5)) {
df_1 %>% select(i)
}
for(i in c(3,5)) {
df_1 %>% select(names()[i])
}
for(i in c(3,5)) {
df_1 %>% names()[i] %>% select()
}
for(i in c(3,5)) {
select(df_1[[i]])
}
for(i in c(3,5)) {
select(df_1[i])
}
for(i in c(3,5)) {
select(df_1[i]) %>%
summarise(n = sum(!is.na()), # nombre de non-manquants
mean = mean(),
sd = sd(),
min = min(),
p25 = quantile(probs = 0.25),
med = median(),
p75 = quantile(probs = 0.75),
max = max())
}
for(i in c(3,5)) {
select(df_1[i]) %>%
summarise(#n = sum(!is.na()), # nombre de non-manquants
mean = mean(),
sd = sd(),
min = min(),
p25 = quantile(probs = 0.25),
med = median(),
p75 = quantile(probs = 0.75),
max = max())
}
for(i in c(3,5)) {
select(df_1[i]) %>%
summarise(#n = sum(!is.na()), # nombre de non-manquants
mean = "mean",
sd = sd(),
min = min(),
p25 = quantile(probs = 0.25),
med = median(),
p75 = quantile(probs = 0.75),
max = max())
}
for(i in c(3,5)) {
select(df_1[i]) %>%
summarise(#n = sum(!is.na()), # nombre de non-manquants
mean = "mean",
sd = "sd",
min = "min",
# p25 = quantile(probs = 0.25),
med = "median",
# p75 = quantile(probs = 0.75),
max = "max"
}
for(i in c(3,5)) {
select(df_1[i]) %>%
summarise(#n = sum(!is.na()), # nombre de non-manquants
mean = "mean",
sd = "sd",
min = "min",
# p25 = quantile(probs = 0.25),
med = "median",
# p75 = quantile(probs = 0.75),
max = "max")
}
for(i in c(3,5)) {
select(df_1[i]) %>%
summarise(#n = sum(!is.na()), # nombre de non-manquants
mean = "mean",
sd = "sd",
min = "min",
# p25 = quantile(probs = 0.25),
med = "median",
# p75 = quantile(probs = 0.75),
max = "max") %>% print()
}
